name: Mark and Close Stale Issues

on:
  schedule:
    # Run daily at 1:00 AM UTC
    - cron: '0 1 * * *'
  workflow_dispatch:
    inputs:
      dryRun:
        description: 'Run in dry-run mode (no changes will be made)'
        required: false
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'

permissions:
  issues: write
  pull-requests: write

jobs:
  stale:
    runs-on: ubuntu-latest
    
    steps:
    - name: Mark stale issues and PRs
      uses: actions/stale@v9
      with:
        repo-token: ${{ secrets.GITHUB_TOKEN }}
        
        # Issue configuration
        stale-issue-message: |
          üëã This issue has been automatically marked as stale because it has not had recent activity. It will be closed in 7 days if no further activity occurs.
          
          If this issue is still relevant:
          - Please leave a comment explaining why it should remain open
          - Consider providing additional context or updates
          - If you're working on this, please mention your progress
          
          Thank you for your contributions! üôè
        
        close-issue-message: |
          This issue has been automatically closed due to inactivity. 
          
          If you believe this was closed in error or the issue persists:
          - Please feel free to reopen it with additional context
          - Create a new issue referencing this one
          
          Thank you for your understanding! üöÄ
        
        stale-issue-label: 'stale'
        close-issue-label: 'auto-closed'
        exempt-issue-labels: 'pinned,security,bug:critical,enhancement:approved,work-in-progress,awaiting-response'
        
        # PR configuration
        stale-pr-message: |
          üëã This pull request has been automatically marked as stale because it has not had recent activity. It will be closed in 14 days if no further activity occurs.
          
          If this PR is still relevant:
          - Please resolve any merge conflicts
          - Respond to any review comments
          - Leave a comment about the current status
          
          Thank you for your contributions! üôè
        
        close-pr-message: |
          This pull request has been automatically closed due to inactivity.
          
          If you would like to continue working on this:
          - Please feel free to reopen it
          - Resolve any merge conflicts
          - Request a new review
          
          Thank you for your understanding! üöÄ
        
        stale-pr-label: 'stale'
        close-pr-label: 'auto-closed'
        exempt-pr-labels: 'pinned,security,work-in-progress,awaiting-review,ready-to-merge'
        
        # Timing configuration
        days-before-issue-stale: 60
        days-before-pr-stale: 30
        days-before-issue-close: 7
        days-before-pr-close: 14
        
        # Activity configuration
        remove-stale-when-updated: true
        remove-issue-stale-when-updated: true
        remove-pr-stale-when-updated: true
        
        # Processing limits
        operations-per-run: 30
        
        # Exempt milestones and assignees
        exempt-all-milestones: false
        exempt-all-assignees: false
        exempt-draft-pr: true
        
        # Additional options
        enable-statistics: true
        ignore-updates: false
        
        # Dry run mode (for testing)
        dry-run: ${{ github.event.inputs.dryRun || 'false' }}
        
        # Comment updates
        delete-branch: false
        
        # Sort by
        ascending: true
        
        # Only process issues/PRs created before this date
        start-date: '2024-01-01'
        
        # Skip stale message for old issues (just label them)
        skip-stale-issue-message: false
        skip-stale-pr-message: false
        
        # Labels to add when marking as stale
        labels-to-add-when-unstale: 'needs-triage'
        
        # Check for activity
        any-of-labels: ''
        any-of-issue-labels: ''
        any-of-pr-labels: ''
        
        # Debugging
        debug-only: false